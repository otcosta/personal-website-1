---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

const title = "Volume Calculator";
const description = "Calculate the volume of common 3D shapes.";
---

<html lang="en">
  <head>
    <BaseHead title={title} description={description} />
    <style>
      main {
        width: 960px;
        max-width: calc(100% - 2em);
        margin: auto;
        padding: 2em 1em;
      }

      h1 {
        text-align: center;
        margin-bottom: 0.25em;
      }

      .subtitle {
        text-align: center;
        color: #666;
        font-size: 0.9em;
        margin-bottom: 2em;
      }

      .card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        padding: 2em;
        max-width: 500px;
        margin: 0 auto;
      }

      .shape-tabs {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 0.5em;
        margin-bottom: 1.5em;
      }

      .shape-btn {
        background: none;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        padding: 0.6em 0.3em;
        font-size: 0.78em;
        color: #666;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.3em;
        transition: all 0.15s;
        font-family: inherit;
      }

      .shape-btn svg {
        width: 26px;
        height: 26px;
        opacity: 0.5;
        transition: opacity 0.15s;
      }

      .shape-btn:hover { border-color: var(--accent); color: var(--accent); }

      .shape-btn.active {
        background: #fff3f0;
        border-color: var(--accent);
        color: var(--accent);
        font-weight: 600;
      }

      .shape-btn.active svg { opacity: 1; }

      .inputs { display: flex; flex-direction: column; gap: 0.9em; }

      .field { display: flex; flex-direction: column; gap: 0.3em; }

      .field label {
        font-size: 0.8em;
        color: #555;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .input-wrap {
        display: flex;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        overflow: hidden;
        transition: border-color 0.15s;
      }

      .input-wrap:focus-within { border-color: var(--accent); }

      input[type="number"] {
        flex: 1;
        border: none;
        padding: 0.6em 0.8em;
        font-size: 1em;
        font-family: inherit;
        outline: none;
        -moz-appearance: textfield;
      }

      input[type="number"]::-webkit-outer-spin-button,
      input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; }

      .unit-badge {
        padding: 0 0.8em;
        background: #f5f5f5;
        border-left: 2px solid #e0e0e0;
        font-size: 0.8em;
        color: #888;
        display: flex;
        align-items: center;
      }

      .unit-row {
        display: flex;
        align-items: center;
        gap: 0.6em;
        margin-top: 0.5em;
        font-size: 0.85em;
        color: #555;
      }

      select {
        font-family: inherit;
        font-size: 0.85em;
        border: 2px solid #e0e0e0;
        border-radius: 6px;
        padding: 0.3em 0.5em;
        outline: none;
        cursor: pointer;
      }

      .calc-btn {
        width: 100%;
        margin-top: 1.5em;
        padding: 0.8em;
        background: var(--accent);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1em;
        font-family: inherit;
        font-weight: 600;
        cursor: pointer;
        transition: opacity 0.15s, transform 0.1s;
      }

      .calc-btn:hover { opacity: 0.88; }
      .calc-btn:active { transform: scale(0.99); }

      .result {
        display: none;
        margin-top: 1.2em;
        padding: 1.2em;
        background: #fff3f0;
        border: 2px solid #f5c9c0;
        border-radius: 10px;
        text-align: center;
        animation: pop 0.2s ease;
      }

      @keyframes pop {
        from { transform: scale(0.96); opacity: 0; }
        to   { transform: scale(1);    opacity: 1; }
      }

      .result.visible { display: block; }

      .vol-number {
        font-size: 2em;
        font-weight: 700;
        color: var(--accent);
        line-height: 1.1;
      }

      .vol-label {
        font-size: 0.82em;
        color: #888;
        margin-top: 0.2em;
      }

      .formula-hint {
        text-align: center;
        font-size: 0.78em;
        color: #aaa;
        margin-top: 0.9em;
        font-style: italic;
      }

      .error {
        display: none;
        color: var(--accent);
        font-size: 0.82em;
        text-align: center;
        margin-top: 0.8em;
      }

      .error.visible { display: block; }
    </style>
  </head>

  <body>
    <Header />
    <main>
      <h1>Volume Calculator</h1>
      <p class="subtitle">Select a shape, enter the dimensions, and get the volume instantly.</p>

      <div class="card">
        <div class="shape-tabs">
          <button class="shape-btn active" data-shape="cube">
            <svg viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M6 10l10-6 10 6v12l-10 6-10-6V10z"/>
              <path d="M16 4v24M6 10l10 6 10-6"/>
            </svg>
            Cube
          </button>
          <button class="shape-btn" data-shape="sphere">
            <svg viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="16" cy="16" r="10"/>
              <ellipse cx="16" cy="16" rx="10" ry="4"/>
              <line x1="6" y1="16" x2="26" y2="16"/>
            </svg>
            Sphere
          </button>
          <button class="shape-btn" data-shape="cylinder">
            <svg viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2">
              <ellipse cx="16" cy="10" rx="10" ry="4"/>
              <ellipse cx="16" cy="22" rx="10" ry="4"/>
              <line x1="6" y1="10" x2="6" y2="22"/>
              <line x1="26" y1="10" x2="26" y2="22"/>
            </svg>
            Cylinder
          </button>
          <button class="shape-btn" data-shape="cone">
            <svg viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2">
              <ellipse cx="16" cy="24" rx="10" ry="4"/>
              <line x1="6" y1="24" x2="16" y2="6"/>
              <line x1="26" y1="24" x2="16" y2="6"/>
            </svg>
            Cone
          </button>
          <button class="shape-btn" data-shape="pyramid">
            <svg viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="16,5 28,26 4,26"/>
              <line x1="4" y1="26" x2="28" y2="26"/>
              <line x1="16" y1="5" x2="16" y2="26"/>
            </svg>
            Pyramid
          </button>
          <button class="shape-btn" data-shape="rectangular">
            <svg viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="5" y="14" width="16" height="13"/>
              <path d="M5 14l5-7h16l-5 7M21 14v13M10 7v7"/>
            </svg>
            Box
          </button>
        </div>

        <div class="inputs" id="inputs"></div>

        <div class="unit-row">
          <label for="unit">Unit:</label>
          <select id="unit">
            <option value="m">meters (m³)</option>
            <option value="cm">centimeters (cm³)</option>
            <option value="ft">feet (ft³)</option>
            <option value="in">inches (in³)</option>
            <option value="mm">millimeters (mm³)</option>
          </select>
        </div>

        <button class="calc-btn" id="calcBtn">Calculate Volume</button>

        <div class="error" id="error">Please fill in all fields with positive numbers.</div>

        <div class="result" id="result">
          <div class="vol-number" id="volValue"></div>
          <div class="vol-label" id="volUnit"></div>
        </div>

        <div class="formula-hint" id="formula"></div>
      </div>
    </main>
    <Footer />

    <script>
      const shapes = {
        cube:        { fields: [{id:'a', label:'Side length'}],                                                          formula: 'V = a³',                    calc: ({a})     => a**3 },
        sphere:      { fields: [{id:'r', label:'Radius'}],                                                               formula: 'V = (4/3) × π × r³',        calc: ({r})     => (4/3)*Math.PI*r**3 },
        cylinder:    { fields: [{id:'r', label:'Radius'}, {id:'h', label:'Height'}],                                     formula: 'V = π × r² × h',            calc: ({r,h})   => Math.PI*r**2*h },
        cone:        { fields: [{id:'r', label:'Radius'}, {id:'h', label:'Height'}],                                     formula: 'V = (1/3) × π × r² × h',   calc: ({r,h})   => (1/3)*Math.PI*r**2*h },
        pyramid:     { fields: [{id:'b', label:'Base area'}, {id:'h', label:'Height'}],                                  formula: 'V = (1/3) × base × h',      calc: ({b,h})   => (1/3)*b*h },
        rectangular: { fields: [{id:'l', label:'Length'}, {id:'w', label:'Width'}, {id:'h', label:'Height'}],           formula: 'V = l × w × h',             calc: ({l,w,h}) => l*w*h },
      };

      const unitNames = { m:'meters', cm:'centimeters', ft:'feet', in:'inches', mm:'millimeters' };
      let currentShape = 'cube';

      function renderInputs(shape) {
        const unit = document.getElementById('unit').value;
        document.getElementById('inputs').innerHTML = shapes[shape].fields.map(f => `
          <div class="field">
            <label for="${f.id}">${f.label}</label>
            <div class="input-wrap">
              <input type="number" id="${f.id}" min="0" step="any" placeholder="0" />
              <span class="unit-badge">${unit}</span>
            </div>
          </div>`).join('');
        document.getElementById('formula').textContent = shapes[shape].formula;
        document.getElementById('result').classList.remove('visible');
        document.getElementById('error').classList.remove('visible');
      }

      document.querySelectorAll('.shape-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.shape-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          currentShape = btn.dataset.shape;
          renderInputs(currentShape);
        });
      });

      document.getElementById('unit').addEventListener('change', () => renderInputs(currentShape));

      document.getElementById('calcBtn').addEventListener('click', () => {
        const shape = shapes[currentShape];
        const vals = {};
        let valid = true;
        shape.fields.forEach(f => {
          const v = parseFloat(document.getElementById(f.id).value);
          if (isNaN(v) || v <= 0) valid = false;
          vals[f.id] = v;
        });

        if (!valid) {
          document.getElementById('error').classList.add('visible');
          document.getElementById('result').classList.remove('visible');
          return;
        }

        document.getElementById('error').classList.remove('visible');
        const unit = document.getElementById('unit').value;
        const volume = shape.calc(vals);
        document.getElementById('volValue').textContent = volume.toLocaleString('en-US', { maximumFractionDigits: 4 });
        document.getElementById('volUnit').textContent = `cubic ${unitNames[unit]} (${unit}³)`;

        const resEl = document.getElementById('result');
        resEl.classList.remove('visible');
        void resEl.offsetWidth;
        resEl.classList.add('visible');
      });

      renderInputs('cube');
    </script>
  </body>
</html>
